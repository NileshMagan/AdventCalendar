<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Advent Calendar üéÑ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI", sans-serif;
    }
    body {
      margin: 0;
      padding: 0;
      background: linear-gradient(135deg, #0f172a 0%, #1e293b 100%);
      color: #e5e7eb;
      min-height: 100vh;
    }
    
    /* Header */
    .header {
      position: sticky;
      top: 0;
      z-index: 100;
      background: rgba(15, 23, 42, 0.95);
      backdrop-filter: blur(10px);
      border-bottom: 1px solid #334155;
      padding: 16px;
    }
    .header-content {
      max-width: 400px;
      margin: 0 auto;
      display: flex;
      justify-content: space-between;
      align-items: center;
    }
    .header h1 {
      margin: 0;
      font-size: 18px;
      font-weight: 600;
    }
    .header-controls {
      display: flex;
      gap: 8px;
      align-items: center;
    }
    .calendar-btn, .edit-btn {
      background: #1d4ed8;
      border: none;
      color: white;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
    }
    .edit-btn.active {
      background: #dc2626;
    }
    
    /* Main container */
    .container {
      max-width: 400px;
      margin: 0 auto;
      position: relative;
      height: calc(100vh - 70px);
      overflow: hidden;
    }
    
    /* Card slider */
    .card-slider {
      display: flex;
      height: 100%;
      transition: transform 0.3s ease;
      will-change: transform;
    }
    
    /* Individual cards */
    .day-card {
      flex: 0 0 100%;
      width: 100%;
      padding: 20px;
      overflow-y: auto;
      position: relative;
    }
    
    .card-content {
      background: rgba(2, 6, 23, 0.8);
      border-radius: 20px;
      padding: 24px;
      border: 1px solid #334155;
      box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3);
      backdrop-filter: blur(10px);
      min-height: calc(100vh - 140px);
      display: flex;
      flex-direction: column;
    }
    
    .date-badge {
      background: linear-gradient(45deg, #dc2626, #ef4444);
      color: white;
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 12px;
      font-weight: 600;
      width: fit-content;
      margin-bottom: 16px;
    }
    
    .day-number {
      font-size: 48px;
      font-weight: 700;
      margin: 0 0 8px;
      background: linear-gradient(45deg, #fbbf24, #f59e0b);
      -webkit-background-clip: text;
      -webkit-text-fill-color: transparent;
      background-clip: text;
    }
    
    .day-title {
      font-size: 20px;
      font-weight: 600;
      margin: 0 0 16px;
      line-height: 1.3;
    }
    
    .day-message {
      font-size: 16px;
      line-height: 1.6;
      color: #cbd5e1;
      white-space: pre-wrap;
      flex-grow: 1;
    }
    
    /* Navigation */
    .nav-overlay {
      position: absolute;
      top: 0;
      bottom: 0;
      width: 60px;
      display: flex;
      align-items: center;
      justify-content: center;
      z-index: 10;
      opacity: 0;
      transition: opacity 0.2s ease;
      pointer-events: none;
    }
    .nav-overlay.visible {
      opacity: 1;
      pointer-events: all;
    }
    .nav-overlay.left {
      left: 0;
      background: linear-gradient(90deg, rgba(0,0,0,0.3) 0%, transparent 100%);
    }
    .nav-overlay.right {
      right: 0;
      background: linear-gradient(-90deg, rgba(0,0,0,0.3) 0%, transparent 100%);
    }
    
    .nav-btn {
      background: rgba(255, 255, 255, 0.1);
      border: 1px solid rgba(255, 255, 255, 0.2);
      color: white;
      width: 40px;
      height: 40px;
      border-radius: 50%;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      backdrop-filter: blur(10px);
      font-size: 18px;
    }
    
    /* Progress indicator */
    .progress {
      position: fixed;
      bottom: 20px;
      left: 50%;
      transform: translateX(-50%);
      background: rgba(0, 0, 0, 0.3);
      padding: 8px 16px;
      border-radius: 999px;
      font-size: 12px;
      backdrop-filter: blur(10px);
      border: 1px solid rgba(255, 255, 255, 0.1);
    }
    
    /* Touch indicator */
    .swipe-hint {
      position: absolute;
      bottom: 40px;
      left: 50%;
      transform: translateX(-50%);
      font-size: 11px;
      color: #64748b;
      text-align: center;
      opacity: 0.7;
    }
    
    /* Calendar picker modal */
    .modal-backdrop {
      position: fixed;
      inset: 0;
      background: rgba(15,23,42,0.9);
      display: none;
      align-items: center;
      justify-content: center;
      z-index: 200;
      backdrop-filter: blur(5px);
    }
    
    .calendar-modal {
      background: #020617;
      border-radius: 16px;
      padding: 20px;
      max-width: 320px;
      width: 90%;
      border: 1px solid #334155;
    }
    
    .calendar-grid {
      display: grid;
      grid-template-columns: repeat(5, 1fr);
      gap: 8px;
      margin-top: 16px;
    }
    
    .calendar-day {
      aspect-ratio: 1;
      border: 1px solid #374151;
      background: transparent;
      color: #9ca3af;
      border-radius: 8px;
      cursor: pointer;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 14px;
      transition: all 0.2s ease;
    }
    
    .calendar-day.available {
      background: #1e293b;
      color: #e5e7eb;
    }
    
    .calendar-day.current {
      background: #dc2626;
      color: white;
      font-weight: 600;
    }
    
    .calendar-day:hover.available {
      background: #334155;
    }
    
    .modal-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 8px;
    }
    
    .modal-title {
      font-size: 16px;
      font-weight: 600;
      margin: 0;
    }
    
    .close-btn {
      background: none;
      border: none;
      color: #9ca3af;
      font-size: 20px;
      cursor: pointer;
      padding: 4px;
    }
    
    /* Today indicator */
    .today-indicator {
      position: absolute;
      top: 16px;
      right: 16px;
      background: #10b981;
      color: white;
      padding: 4px 8px;
      border-radius: 12px;
      font-size: 10px;
      font-weight: 600;
    }
    
    /* Mobile optimizations */
    @media (max-width: 480px) {
      .card-content {
        padding: 20px;
        margin: 10px;
      }
      
      .day-number {
        font-size: 42px;
      }
      
      .day-title {
        font-size: 18px;
      }
      
      .day-message {
        font-size: 15px;
      }
    }
    
    /* Loading state */
    .loading {
      display: flex;
      align-items: center;
      justify-content: center;
      height: 100vh;
      font-size: 18px;
    }
    
    /* Edit mode styles */
    .edit-field {
      margin-bottom: 12px;
    }
    .edit-field label {
      display: block;
      font-size: 11px;
      color: #9ca3af;
      margin-bottom: 4px;
      font-weight: 500;
    }
    .edit-field input,
    .edit-field textarea {
      width: 100%;
      background: rgba(15, 23, 42, 0.8);
      border: 1px solid #334155;
      color: #e5e7eb;
      padding: 8px 12px;
      border-radius: 8px;
      font-size: 14px;
      font-family: inherit;
      resize: vertical;
      /* Ensure form elements are interactive */
      pointer-events: all;
      touch-action: manipulation;
    }
    .edit-field textarea {
      min-height: 120px;
      line-height: 1.5;
    }
    .edit-field input:focus,
    .edit-field textarea:focus {
      outline: none;
      border-color: #1d4ed8;
      box-shadow: 0 0 0 2px rgba(29, 78, 216, 0.2);
    }
    .edit-actions {
      display: flex;
      gap: 8px;
      margin-top: 16px;
      justify-content: flex-end;
    }
    .save-btn, .cancel-btn {
      padding: 8px 16px;
      border-radius: 8px;
      font-size: 12px;
      cursor: pointer;
      border: none;
      pointer-events: all;
      touch-action: manipulation;
    }
    .save-btn {
      background: #10b981;
      color: white;
    }
    .cancel-btn {
      background: #6b7280;
      color: white;
    }
    .edit-mode .day-message {
      display: none;
    }
    .view-mode .edit-content {
      display: none;
    }
    
    /* Disable swipe gestures in edit mode */
    .edit-mode .container {
      touch-action: auto;
    }
    /* Disable text selection on swipe areas */
    .container {
      -webkit-user-select: none;
      -moz-user-select: none;
      -ms-user-select: none;
      user-select: none;
    }
    
    .day-message {
      -webkit-user-select: text;
      -moz-user-select: text;
      -ms-user-select: text;
      user-select: text;
    }
  </style>
</head>
<body>
  <div class="loading" id="loading">
    Loading calendar... üéÑ
  </div>

  <div class="header" id="header" style="display: none;">
    <div class="header-content">
      <h1>üéÑ Advent Calendar</h1>
      <div class="header-controls">
        <button class="edit-btn" id="editBtn">‚úèÔ∏è Edit</button>
        <button class="calendar-btn" id="calendarBtn">üìÖ Go to Day</button>
      </div>
    </div>
  </div>

  <div class="container" id="container" style="display: none;">
    <div class="card-slider" id="cardSlider">
      <!-- Cards will be generated here -->
    </div>
    
    <!-- Navigation overlays -->
    <div class="nav-overlay left" id="navLeft">
      <button class="nav-btn" id="prevBtn">‚Äπ</button>
    </div>
    <div class="nav-overlay right" id="navRight">
      <button class="nav-btn" id="nextBtn">‚Ä∫</button>
    </div>
    
    <div class="swipe-hint">
      Swipe left/right to navigate
    </div>
  </div>

  <div class="progress" id="progress" style="display: none;">
    Day <span id="currentDay">1</span> of <span id="totalDays">30</span>
  </div>

  <!-- Calendar picker modal -->
  <div class="modal-backdrop" id="modalBackdrop">
    <div class="calendar-modal">
      <div class="modal-header">
        <h3 class="modal-title">Choose a Day</h3>
        <button class="close-btn" id="closeModal">√ó</button>
      </div>
      <div class="calendar-grid" id="calendarGrid">
        <!-- Calendar days will be generated here -->
      </div>
    </div>
  </div>

  <script>
    let messages = [];
    let currentIndex = 0;
    let isTransitioning = false;
    let isEditMode = false;
    
    // Touch handling
    let startX = 0;
    let currentX = 0;
    let isDragging = false;
    
    async function loadMessages() {
      try {
        const response = await fetch('./messages.json');
        messages = await response.json();
        
        // Sort by date to ensure proper order
        messages.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        initializeApp();
      } catch (error) {
        console.error('Failed to load messages:', error);
        document.getElementById('loading').innerHTML = 'Failed to load calendar data';
      }
    }
    
    function initializeApp() {
      if (messages.length === 0) {
        document.getElementById('loading').innerHTML = 'No calendar data found';
        return;
      }
      
      const today = new Date();
      const todayString = today.toISOString().split('T')[0];
      
      // Find today's index or closest available day
      const todayIndex = messages.findIndex(msg => msg.date === todayString);
      currentIndex = todayIndex >= 0 ? todayIndex : 0;
      
      renderCards();
      setupNavigation();
      setupCalendarPicker();
      setupEditMode();
      
      document.getElementById('loading').style.display = 'none';
      document.getElementById('header').style.display = 'block';
      document.getElementById('container').style.display = 'block';
      document.getElementById('progress').style.display = 'block';
      
      updateProgress();
      updateSlider();
    }
    
    function renderCards() {
      const slider = document.getElementById('cardSlider');
      slider.innerHTML = '';
      
      messages.forEach((message, index) => {
        const card = document.createElement('div');
        card.className = 'day-card';
        
        const today = new Date().toISOString().split('T')[0];
        const isToday = message.date === today;
        const dayNumber = new Date(message.date).getDate();
        
        card.innerHTML = `
          <div class="card-content">
            ${isToday ? '<div class="today-indicator">Today</div>' : ''}
            <div class="date-badge">${message.date}</div>
            <div class="day-number">${dayNumber}</div>
            <div class="day-title">${message.subject}</div>
            <div class="day-message">${message.body}</div>
            <div class="edit-content" style="display: none;">
              <div class="edit-field">
                <label for="edit-date-${index}">Date (YYYY-MM-DD)</label>
                <input type="text" id="edit-date-${index}" value="${message.date}">
              </div>
              <div class="edit-field">
                <label for="edit-subject-${index}">Subject</label>
                <input type="text" id="edit-subject-${index}" value="${message.subject}">
              </div>
              <div class="edit-field">
                <label for="edit-body-${index}">Message</label>
                <textarea id="edit-body-${index}">${message.body}</textarea>
              </div>
              <div class="edit-actions">
                <button class="cancel-btn" onclick="cancelEdit()">Cancel</button>
                <button class="save-btn" onclick="saveMessage(${index})">Save</button>
              </div>
            </div>
          </div>
        `;
        
        slider.appendChild(card);
      });
    }
    
    function updateSlider() {
      const slider = document.getElementById('cardSlider');
      const translateX = -currentIndex * 100;
      slider.style.transform = `translateX(${translateX}%)`;
      updateProgress();
      updateNavigationVisibility();
    }
    
    function updateProgress() {
      document.getElementById('currentDay').textContent = currentIndex + 1;
      document.getElementById('totalDays').textContent = messages.length;
    }
    
    function updateNavigationVisibility() {
      const navLeft = document.getElementById('navLeft');
      const navRight = document.getElementById('navRight');
      
      navLeft.classList.toggle('visible', currentIndex > 0);
      navRight.classList.toggle('visible', currentIndex < messages.length - 1);
    }
    
    function goToDay(index) {
      if (index < 0 || index >= messages.length || isTransitioning) return;
      
      isTransitioning = true;
      currentIndex = index;
      updateSlider();
      
      setTimeout(() => {
        isTransitioning = false;
      }, 300);
    }
    
    function setupNavigation() {
      document.getElementById('prevBtn').addEventListener('click', () => {
        goToDay(currentIndex - 1);
      });
      
      document.getElementById('nextBtn').addEventListener('click', () => {
        goToDay(currentIndex + 1);
      });
      
      // Touch/swipe handling
      const container = document.getElementById('container');
      
      container.addEventListener('touchstart', handleTouchStart, { passive: false });
      container.addEventListener('touchmove', handleTouchMove, { passive: false });
      container.addEventListener('touchend', handleTouchEnd, { passive: false });
      
      // Mouse events for desktop
      container.addEventListener('mousedown', handleMouseStart);
      container.addEventListener('mousemove', handleMouseMove);
      container.addEventListener('mouseup', handleMouseEnd);
      container.addEventListener('mouseleave', handleMouseEnd);
      
      // Keyboard navigation
      document.addEventListener('keydown', (e) => {
        if (e.key === 'ArrowLeft') {
          goToDay(currentIndex - 1);
        } else if (e.key === 'ArrowRight') {
          goToDay(currentIndex + 1);
        }
      });
    }
    
    function handleStart(clientX) {
      if (isTransitioning || isEditMode) return;
      startX = clientX;
      currentX = clientX;
      isDragging = true;
    }
    
    function handleMove(clientX) {
      if (!isDragging || isTransitioning || isEditMode) return;
      
      currentX = clientX;
      const deltaX = currentX - startX;
      const threshold = 50; // Minimum drag distance to trigger swipe
      
      // Visual feedback during drag
      const slider = document.getElementById('cardSlider');
      const baseTransform = -currentIndex * 100;
      const dragPercent = (deltaX / window.innerWidth) * 100;
      
      slider.style.transform = `translateX(${baseTransform + dragPercent}%)`;
    }
    
    function handleEnd() {
      if (!isDragging || isTransitioning || isEditMode) return;
      
      const deltaX = currentX - startX;
      const threshold = window.innerWidth * 0.3; // 30% of screen width
      
      isDragging = false;
      
      if (Math.abs(deltaX) > threshold) {
        if (deltaX > 0 && currentIndex > 0) {
          // Swipe right - go to previous
          goToDay(currentIndex - 1);
        } else if (deltaX < 0 && currentIndex < messages.length - 1) {
          // Swipe left - go to next
          goToDay(currentIndex + 1);
        } else {
          // Snap back
          updateSlider();
        }
      } else {
        // Snap back
        updateSlider();
      }
    }
    
    // Touch events
    function handleTouchStart(e) {
      // Don't handle touch events on form elements in edit mode
      if (isEditMode && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON')) {
        return;
      }
      handleStart(e.touches[0].clientX);
    }
    
    function handleTouchMove(e) {
      // Don't handle touch events on form elements in edit mode
      if (isEditMode && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON')) {
        return;
      }
      if (!isDragging || isTransitioning || isEditMode) return;
      e.preventDefault(); // Prevent scrolling
      handleMove(e.touches[0].clientX);
    }
    
    function handleTouchEnd(e) {
      handleEnd();
    }
    
    // Mouse events
    function handleMouseStart(e) {
      // Don't handle mouse events on form elements in edit mode
      if (isEditMode && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON')) {
        return;
      }
      e.preventDefault();
      handleStart(e.clientX);
    }
    
    function handleMouseMove(e) {
      // Don't handle mouse events on form elements in edit mode
      if (isEditMode && (e.target.tagName === 'INPUT' || e.target.tagName === 'TEXTAREA' || e.target.tagName === 'BUTTON')) {
        return;
      }
      handleMove(e.clientX);
    }
    
    function handleMouseEnd(e) {
      handleEnd();
    }
    
    function setupCalendarPicker() {
      const calendarBtn = document.getElementById('calendarBtn');
      const modalBackdrop = document.getElementById('modalBackdrop');
      const closeModal = document.getElementById('closeModal');
      const calendarGrid = document.getElementById('calendarGrid');
      
      calendarBtn.addEventListener('click', () => {
        renderCalendarGrid();
        modalBackdrop.style.display = 'flex';
      });
      
      closeModal.addEventListener('click', () => {
        modalBackdrop.style.display = 'none';
      });
      
      modalBackdrop.addEventListener('click', (e) => {
        if (e.target === modalBackdrop) {
          modalBackdrop.style.display = 'none';
        }
      });
    }
    
    function renderCalendarGrid() {
      const grid = document.getElementById('calendarGrid');
      grid.innerHTML = '';
      
      const today = new Date().toISOString().split('T')[0];
      
      messages.forEach((message, index) => {
        const day = document.createElement('button');
        day.className = 'calendar-day available';
        
        const dayNumber = new Date(message.date).getDate();
        day.textContent = dayNumber;
        
        if (message.date === today) {
          day.classList.add('current');
        }
        
        day.addEventListener('click', () => {
          goToDay(index);
          document.getElementById('modalBackdrop').style.display = 'none';
        });
        
        grid.appendChild(day);
      });
    }
    
    function setupEditMode() {
      const editBtn = document.getElementById('editBtn');
      
      editBtn.addEventListener('click', () => {
        toggleEditMode();
      });
    }
    
    function toggleEditMode() {
      isEditMode = !isEditMode;
      const editBtn = document.getElementById('editBtn');
      const container = document.getElementById('container');
      
      if (isEditMode) {
        editBtn.textContent = 'üëÅÔ∏è View';
        editBtn.classList.add('active');
        container.classList.add('edit-mode');
        container.classList.remove('view-mode');
        // Disable swipe navigation in edit mode
        container.style.touchAction = 'auto';
      } else {
        editBtn.textContent = '‚úèÔ∏è Edit';
        editBtn.classList.remove('active');
        container.classList.add('view-mode');
        container.classList.remove('edit-mode');
        // Re-enable swipe navigation in view mode
        container.style.touchAction = 'pan-x';
      }
      
      // Update all cards
      updateCardDisplay();
    }
    
    function updateCardDisplay() {
      const cards = document.querySelectorAll('.day-card');
      cards.forEach(card => {
        const messageEl = card.querySelector('.day-message');
        const editContent = card.querySelector('.edit-content');
        
        if (isEditMode) {
          messageEl.style.display = 'none';
          editContent.style.display = 'block';
        } else {
          messageEl.style.display = 'block';
          editContent.style.display = 'none';
        }
      });
    }
    
    function saveMessage(index) {
      const dateInput = document.getElementById(`edit-date-${index}`);
      const subjectInput = document.getElementById(`edit-subject-${index}`);
      const bodyInput = document.getElementById(`edit-body-${index}`);
      
      // Update the message data
      messages[index] = {
        date: dateInput.value,
        subject: subjectInput.value,
        body: bodyInput.value
      };
      
      // Save to localStorage
      localStorage.setItem('advent_messages', JSON.stringify(messages));
      
      // Re-render the current card
      renderCards();
      updateSlider();
      
      // Show instructions for syncing with GitHub
      showSyncInstructions();
    }
    
    function showSyncInstructions() {
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: #1d4ed8;
        color: white;
        padding: 12px 20px;
        border-radius: 12px;
        font-size: 12px;
        z-index: 1000;
        max-width: 320px;
        text-align: center;
        line-height: 1.4;
        box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        cursor: pointer;
      `;
      toast.innerHTML = `
        <div style="font-weight: 600; margin-bottom: 4px;">‚úÖ Saved locally!</div>
        <div style="margin-bottom: 8px;">Tap to sync with GitHub for emails ‚Üí</div>
        <div style="font-size: 10px; opacity: 0.8;">This will update the actual messages.json file</div>
      `;
      
      toast.addEventListener('click', () => {
        syncWithGitHub();
        document.body.removeChild(toast);
      });
      
      document.body.appendChild(toast);
      
      setTimeout(() => {
        if (document.body.contains(toast)) {
          document.body.removeChild(toast);
        }
      }, 8000);
    }
    
    function syncWithGitHub() {
      // Get current edited messages
      const currentMessages = loadFromStorage() || messages;
      const jsonString = JSON.stringify(currentMessages, null, 2);
      
      // Create the GitHub Actions URL
      const repoUrl = 'https://github.com/NileshMagan/AdventCalendar';
      const actionUrl = `${repoUrl}/actions/workflows/update-messages.yml`;
      
      // Show sync modal
      showSyncModal(jsonString, actionUrl);
    }
    
    function showSyncModal(jsonString, actionUrl) {
      const modal = document.createElement('div');
      modal.style.cssText = `
        position: fixed;
        top: 0;
        left: 0;
        right: 0;
        bottom: 0;
        background: rgba(15, 23, 42, 0.95);
        display: flex;
        align-items: center;
        justify-content: center;
        z-index: 300;
        padding: 16px;
      `;
      
      modal.innerHTML = `
        <div style="
          background: #020617;
          border-radius: 16px;
          padding: 24px;
          max-width: 500px;
          width: 100%;
          border: 1px solid #334155;
        ">
          <h3 style="margin: 0 0 16px; color: #e5e7eb; display: flex; align-items: center; gap: 8px;">
            üîÑ Sync with GitHub
          </h3>
          <div style="margin-bottom: 16px; color: #cbd5e1; font-size: 14px; line-height: 1.5;">
            <p style="margin: 0 0 12px;"><strong>Step 1:</strong> Copy the JSON below</p>
            <p style="margin: 0 0 12px;"><strong>Step 2:</strong> Click "Open GitHub Actions"</p>
            <p style="margin: 0 0 12px;"><strong>Step 3:</strong> Click "Run workflow" ‚Üí Paste JSON ‚Üí Run</p>
            <p style="margin: 0; font-size: 12px; opacity: 0.8;">This will update emails to use your edits</p>
          </div>
          
          <textarea readonly id="syncJsonArea" style="
            width: 100%;
            height: 120px;
            background: #0f172a;
            border: 1px solid #334155;
            border-radius: 8px;
            padding: 12px;
            color: #e5e7eb;
            font-family: monospace;
            font-size: 11px;
            line-height: 1.3;
            margin-bottom: 16px;
            resize: vertical;
          ">${jsonString}</textarea>
          
          <div style="display: flex; gap: 8px; justify-content: space-between; flex-wrap: wrap;">
            <button onclick="this.closest('div[style*=\"position: fixed\"]').remove()" style="
              background: #6b7280;
              color: white;
              border: none;
              padding: 8px 16px;
              border-radius: 8px;
              cursor: pointer;
              font-size: 12px;
            ">Cancel</button>
            
            <div style="display: flex; gap: 8px;">
              <button onclick="
                const textarea = document.getElementById('syncJsonArea');
                textarea.select();
                navigator.clipboard.writeText(textarea.value).then(() => {
                  this.textContent = '‚úì Copied!';
                  this.style.background = '#10b981';
                  setTimeout(() => {
                    this.textContent = 'Copy JSON';
                    this.style.background = '#1d4ed8';
                  }, 2000);
                });
              " style="
                background: #1d4ed8;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 12px;
              ">Copy JSON</button>
              
              <button onclick="window.open('${actionUrl}', '_blank')" style="
                background: #059669;
                color: white;
                border: none;
                padding: 8px 16px;
                border-radius: 8px;
                cursor: pointer;
                font-size: 12px;
              ">Open GitHub Actions</button>
            </div>
          </div>
        </div>
      `;
      
      document.body.appendChild(modal);
      
      // Auto-select the JSON
      const textarea = modal.querySelector('#syncJsonArea');
      textarea.focus();
      textarea.select();
    }
    
    function cancelEdit() {
      // Just toggle back to view mode, discarding changes
      toggleEditMode();
    }
    
    function showToast(message) {
      // Create a temporary toast notification
      const toast = document.createElement('div');
      toast.style.cssText = `
        position: fixed;
        bottom: 80px;
        left: 50%;
        transform: translateX(-50%);
        background: #10b981;
        color: white;
        padding: 8px 16px;
        border-radius: 8px;
        font-size: 12px;
        z-index: 1000;
      `;
      toast.textContent = message;
      document.body.appendChild(toast);
      
      setTimeout(() => {
        document.body.removeChild(toast);
      }, 2000);
    }
    
    function loadFromStorage() {
      try {
        const stored = localStorage.getItem('advent_messages');
        if (stored) {
          const parsed = JSON.parse(stored);
          if (Array.isArray(parsed) && parsed.length > 0) {
            return parsed;
          }
        }
      } catch (e) {
        console.error('Failed to load from localStorage:', e);
      }
      return null;
    }
    
    async function loadMessages() {
      try {
        // First try to load from localStorage (user edits)
        let storedMessages = loadFromStorage();
        
        if (storedMessages) {
          messages = storedMessages;
        } else {
          // Fall back to loading from messages.json
          const response = await fetch('./messages.json');
          messages = await response.json();
          
          // Save initial data to localStorage for future edits
          localStorage.setItem('advent_messages', JSON.stringify(messages));
        }
        
        // Sort by date to ensure proper order
        messages.sort((a, b) => new Date(a.date) - new Date(b.date));
        
        initializeApp();
      } catch (error) {
        console.error('Failed to load messages:', error);
        document.getElementById('loading').innerHTML = 'Failed to load calendar data';
      }
    }
    
    // Initialize the app
    loadMessages();
  </script>
</body>
</html>
</html>